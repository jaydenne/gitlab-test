include:
  - project: 'matonto/gitlab-ci'
    ref: master
    file: 'shared-template.yml'
    
    
image: gitlab.inovexcorp.com:4567/ilab/docker-images/maven-node-jdk8

before_script:
  - PRIVATE_URL="$(echo $CI_PROJECT_URL | sed "s|https://|https://jesse.nelson:Fy7aP9DyKZQ66osrYgZc@|g").git"
  - git remote set-url origin $PRIVATE_URL
  - git config --global user.email 'gitlab.runner@inovexcorp.com'
  - git config --global user.name 'Gitlab Runner'

stages:
  - create_release_branch
  - new_release_deploy

  - test
  - set_version_root_pom
  - set_version_parent_pom
  - update_master_with_new_version
  - increment_snapshot_version_root_pom
  - increment_snapshot_version_parent_pom
  - update_master_with_new_snapshot
  - unit_integration_test
  - deploy_artifacts
  - deploy_rdf_orm
  - create_release_branch
  - update_minor_release_root_pom
  - update_minor_release_parent_pom
  - update_master_with_new_minor_snapshot

create_release_branch:
  stage: create_release_branch
  only:
    - /release\/\d+\.\d+/
  except:
    - branches
  script:
    - git tag -d $CI_COMMIT_TAG
    - git push origin :$CI_COMMIT_TAG
    - git checkout -b $CI_COMMIT_TAG
    - git push origin $CI_COMMIT_TAG

update_github:
  stage: new_release_deploy
  only:
    - /release\d*\.\d*/
  except:
    - branches
  script:
    # - git remote add github git@github.com:inovexcorp/mobi.git
    - git remote add github git@github.com:jaydenne/gitlab-test.git
    - git checkout remotes/gitlab/master
    - git push github HEAD:master
    - git checkout remotes/gitlab/$CI_COMMIT_TAG
    - git push github HEAD:$CI_COMMIT_TAG